--// Blood Debt ESP Script (Self-Reloading) //--

-- Self reload setup
local sourceURL = "https://raw.githubusercontent.com/uzergit/blooddebt-rbx/refs/heads/main/main"

local function reloadScript()
    task.spawn(function()
        local newScript = loadstring(game:HttpGet(sourceURL))()
    end)
end

-- Services
local Players    = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp         = Players.LocalPlayer

-- Weapon lookup tables
local killerWeapons = {
    ["Charcoal Steel JS-22"] = true, ["Pretty Pink RR-LCP"] = true, ["JS-2 BondsDerringy"] = true,
    ["GILDED"] = true, ["Kamatov"] = true, ["JS2-Derringy"] = true, ["JS-22"] = true,
    ["NGO"] = true, ["Throwing Dagger"] = true, ["SoundMaker"] = true, ["SoundMakerSlower"] = true,
    ["RR-LightCompactPistolS"] = true, ["J9-Mereta"] = true, ["RY's GG-17"] = true,
    ["RR-LCP"] = true, ["JS1 Competitor"] = true, ["AT's KAR15"] = true, ["VK's ANM"] = true,
    ["Clothed Sawn-off"] = true, ["Sawn-off"] = true, ["Clothed Rosen-Obrez"] = true,
    ["Rosen-Obrez"] = true, ["Dark Steel K1911"] = true, ["Silver Steel K1911"] = true,
    ["K1911"] = true, ["ZZ-90"] = true, ["SKORPION"] = true
}

local vigilanteWeapons = {
    ["Beagle"] = true, ["I-412"] = true, ["Silver Steel RR-Snubby"] = true,
    ["RR-Snubby"] = true, ["GG-17"] = true, ["J9-M"] = true, ["J9-Meretta"] = true
}

-- State
local espEnabled    = false
local checkingRoles = false
local running       = true
local screenGui

-- Highlight helpers
local function addHighlights(character, color)
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
            local box = Instance.new("BoxHandleAdornment")
            box.Name        = "ESPBox"
            box.Adornee     = part
            box.AlwaysOnTop = true
            box.ZIndex      = 10
            box.Size        = part.Size
            box.Color3      = color
            box.Transparency= 0.7
            box.Parent      = part
        end
    end
end

local function clearHighlights(character)
    for _, part in ipairs(character:GetDescendants()) do
        local box = part:FindFirstChild("ESPBox")
        if box then
            box:Destroy()
        end
    end
end

-- Role detection
local function playerHasRole(player)
    local function checkContainer(container)
        if not container then return nil end
        for _, item in ipairs(container:GetChildren()) do
            if killerWeapons[item.Name] then
                return "Killer"
            elseif vigilanteWeapons[item.Name] then
                return "Vigilante"
            end
        end
    end

    local role = checkContainer(player:FindFirstChildOfClass("Backpack"))
    if role then return role end
    if player.Character then
        role = checkContainer(player.Character)
    end
    return role
end

-- Scan once, highlight if found
local function detectRoles()
    local found = false
    for _, pl in ipairs(Players:GetPlayers()) do
        if pl ~= lp and pl.Character then
            local role = playerHasRole(pl)
            clearHighlights(pl.Character)
            if role == "Killer" then
                addHighlights(pl.Character, Color3.fromRGB(255, 0, 0))
                found = true
            elseif role == "Vigilante" then
                addHighlights(pl.Character, Color3.fromRGB(0, 255, 255))
                found = true
            end
        end
    end
    checkingRoles = not found
end

-- GUI builder
local function buildGUI()
    if screenGui then screenGui:Destroy() end

    screenGui = Instance.new("ScreenGui")
    screenGui.Name            = "ESP_Gui"
    screenGui.ResetOnSpawn    = false
    screenGui.Parent          = lp:WaitForChild("PlayerGui")

    local frame = Instance.new("Frame", screenGui)
    frame.Name               = "MainFrame"
    frame.Size               = UDim2.new(0, 200, 0, 50)
    frame.Position           = UDim2.new(0, 20, 0, 20)
    frame.BackgroundColor3   = Color3.fromRGB(30, 30, 30)
    frame.BorderSizePixel    = 0
    frame.Active             = true
    frame.Draggable          = true

    local label = Instance.new("TextLabel", frame)
    label.Size               = UDim2.new(1, 0, 0, 20)
    label.BackgroundTransparency = 1
    label.Text               = "ESP Toggle"
    label.TextColor3         = Color3.fromRGB(255, 255, 255)
    label.TextScaled         = true

    local btn = Instance.new("TextButton", frame)
    btn.Size                 = UDim2.new(1, 0, 0, 30)
    btn.Position             = UDim2.new(0, 0, 0, 20)
    btn.BackgroundColor3     = Color3.fromRGB(50, 50, 50)
    btn.TextColor3           = Color3.fromRGB(255, 255, 255)
    btn.Text                 = espEnabled and "Disable ESP" or "Enable ESP"

    btn.MouseButton1Click:Connect(function()
        espEnabled = not espEnabled
        btn.Text   = espEnabled and "Disable ESP" or "Enable ESP"
        checkingRoles = espEnabled
        if not espEnabled then
            for _, p in ipairs(Players:GetPlayers()) do
                if p.Character then
                    clearHighlights(p.Character)
                end
            end
        else
            detectRoles()
        end
    end)
end

-- Death & Respawn
local function onDeath()
    running = false -- stop the esp loop
    reloadScript()
end

local function onCharacterAdded(char)
    local hum = char:WaitForChild("Humanoid")
    hum.Died:Connect(onDeath)
    task.wait(1)
    buildGUI()

    if espEnabled then
        checkingRoles = true
        detectRoles()
        local btn = screenGui:FindFirstChild("MainFrame"):FindFirstChildOfClass("TextButton")
        if btn then
            btn.Text = "Disable ESP"
        end
    end
end

-- Main loop
lp.CharacterAdded:Connect(onCharacterAdded)
if lp.Character then
    onCharacterAdded(lp.Character)
end

task.spawn(function()
    while running do
        if espEnabled and checkingRoles then
            detectRoles()
        end
        task.wait(1)
    end
end)
